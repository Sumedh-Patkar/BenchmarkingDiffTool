{% extends 'base.html' %}

{% block title %}
All Runs of the test
{% endblock title %}


{% block content %}

	<h2 style="font-weight: bold; text-align: center;">{{ context.testname }}</h2>
	
	<div id="graph-div">
		<span>
			<select id="yParameter" name="yParameter">
				<!-- TAKING PARAMETERS FROM INI FILE -->
				{% for qualifier in context.qualifier_list %}
					{% if loop.index0 == 0 %}
						<option value="{{ qualifier }}" selected="selected">{{ qualifier }}</option>
					{% else %}
						<option value="{{ qualifier }}">{{ qualifier }}</option>
					{% endif %}
				{% endfor %}
			</select>
			<p>vs</p>
			<select id="xParameter" name="xParameter">
				<option value="Kernel Version" selected="selected">Kernel Version</option>
				<option value="OS Version">OS Version</option>
				<option value="OS Name">OS Name</option>
				<option value="Firmware Version">Firmware Version</option>
				<option value="ToolChain Name">ToolChain Name</option>
				<option value="ToolChain Version">ToolChain Version</option>
				<!-- <option value="Flags">Flags</option> -->
			</select>

			<button id="download-png" class="blue" onclick="downloadAsPng()">Download as PNG</button>
		</span>
		<div id="comparison-graph"></div>
	</div>

	<form action="/diff" method="POST">

		<div class='inline-block-child'>
			<table id="allRunsTable">
				<thead>
					<tr>
						<th>Select to Compare</th>
						{% for column in context.data %}

							<th>{{ column }}</th>
						{% endfor %}
					</tr>
				</thead>

				<tbody>
					{% for row in range(context.no_of_rows) %}
						{% set i = loop.index0 %}
						<tr class="table-row">
							{% for key in context.data %}
								{% if loop.index0 == 0%}
									<td><input class="checkbox diff-checkbox" type="checkbox" name="diff-checkbox{{i}}" value="{{ context.data['originID'][i] }}"></td>
									<td class="originID table-cell"><a href="/test-details/{{ context.data[key][i] }}">{{ context.data[key][i] }}</a></td>
								{% else %}
									<td class="table-cell"> {{ context.data[key][i] }}</td>
								{% endif %}
							{% endfor %}
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		
	</form>

<script>
	uncheckBoxes("diff-checkbox");

	function sendAjaxRequest(xParameter, yParameter){
		$.ajax({
	    	url: '/get_data_for_graph',
			method: "POST",
			dataType: 'json',
			contentType: "application/json",
			data: JSON.stringify({
				"xParameter" : xParameter,
				"yParameter" : yParameter,
				"testname" : "{{ context.testname }}",
			}),
		}).done(function(response){
			console.log("DONEEEEEEE")
			console.log(response)
			drawComparisonGraph(response.x_list, response.y_list, xParameter, yParameter)
		})
	}

	$(document).ready(function() {
	    // Setup - append a text input to each header cell
	    $('#allRunsTable thead tr').clone(true).appendTo( '#allRunsTable thead' );
	    $('#allRunsTable thead tr:eq(1) th').each( function (i) {
	    	if(i == 0)
	    		$(this).html( '<button id="diff-button" class="blue" type="submit">Compare</button>' );
	    	else
	        {
	        	var title = $(this).text();
	        	$(this).html( '<input type="text" placeholder="Search '+title+'" />' );
	        }
	 
	        $( 'input', this ).on( 'keyup change', function () {
	            if ( table.column(i).search() !== this.value ) {
	                table
	                    .column(i)
	                    .search( this.value )
	                    .draw();
	            }
	        });
	    } );
	 
	    var table = $('#allRunsTable').DataTable( {
	    	"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
	        orderCellsTop: true,
	        fixedHeader: true
	    });

	    
	    //draw the first graph according to the selected values
		var xParameter = $("#xParameter option:selected").val();
		console.log("xParameter is = #" + xParameter + "#")
		var yParameter = $("#yParameter option:selected").val();
		console.log("yParameter is = #" + yParameter + "#")
	    
	    //Function for drawing INITIAL comparison graph
	    sendAjaxRequest(xParameter, yParameter)

		// AJAX request to get_data_for_graph for redrawing the graph on "xParameter" changed event
		$(function(){
			$("#xParameter").change(function(){
				//update the xParameter value
				xParameter = $('option:selected', this).text()

				sendAjaxRequest(xParameter, yParameter)
			})
		});


		// AJAX request to get_data_for_graph for redrawing the graph on "xParameter" changed event
		$(function(){
			$("#yParameter").change(function(){
				//update the yParameter value
				yParameter = $('option:selected', this).text()

				sendAjaxRequest(xParameter, yParameter)
			})
		});



	});

</script>
	

{% endblock content %}